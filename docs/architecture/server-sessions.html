<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Server & Sessions - BSP Architecture</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav>
        <a href="../index.html" class="logo">BSP Docs</a>
        <ul>
            <li><a href="index.html" class="active">Architecture</a></li>
            <li><a href="../theory/index.html">Theory</a></li>
            <li><a href="../wiki/index.html">Wiki & Glossary</a></li>
            <li><a href="../specs/index.html">Specs</a></li>
        </ul>
    </nav>

    <div class="container">
        <aside class="sidebar">
            <h3>Architecture</h3>
            <ul>
                <li><a href="index.html">Overview</a></li>
                <li><a href="core-engine.html">Core Engine</a></li>
                <li><a href="data-flow.html">Data Flow</a></li>
                <li><a href="data-structures.html">Data Structures</a></li>
                <li><a href="server-sessions.html" class="active">Server & Sessions</a></li>
            </ul>
        </aside>

        <main class="content">
            <h1>Server & Session Management</h1>
            <p>BSP operates as a stateful conversational agent. Unlike standard REST APIs which are stateless, BSP maintains a persistent context and learning state for each session.</p>

            <h2>How Chat Sessions Work</h2>
            <p>When a user starts a chat, the following happens:</p>
            <ol>
                <li><strong>Session Creation:</strong> A new <code>Session</code> object is instantiated.</li>
                <li><strong>Model Cloning (Optional):</strong> The session can be initialized with a "Base Brain" (pre-trained model) or start fresh. This allows for "tabula rasa" learning or fine-tuning.</li>
                <li><strong>Context Loop:</strong> As the user chats, the <code>ActiveGroups</code> from turn <code>N</code> become the <code>Context</code> for turn <code>N+1</code>.</li>
            </ol>

            <div class="callout">
                <h4>Training is Continuous</h4>
                <p>There is no "Training Mode" vs "Inference Mode". Every message you send triggers the <strong>Learning Loop</strong>. The system tries to predict your input, calculates surprise, and updates its Groups and Deduction Graph instantly.</p>
            </div>

            <h2>Architecture Layering</h2>
            <pre><code>HTTP / WebSocket Server
      │
      ▼
Session Manager (Map<ID, Session>)
      │
      ▼
   Session
      ├── Context (Last Active Groups)
      ├── History (Messages)
      └── BSPEngine (The Brain)
            ├── GroupStore
            └── DeductionGraph</code></pre>

            <h2>Persistence & Serialization</h2>
            <p>Sessions can be saved to disk. We use a custom binary format (BSP - Bitset Prediction Core Memory) or JSON for portability.</p>
            <ul>
                <li><strong>Snapshots:</strong> You can save the state of the brain at any point.</li>
                <li><strong>Time Travel:</strong> Since the state is fully serializable, you can "fork" a conversation or revert to a previous mental state.</li>
            </ul>

            <div class="pager">
                <a href="data-structures.html" class="pager-link prev">
                    <span class="label">Previous</span>
                    <span class="title">Data Structures</span>
                </a>
                <span class="pager-link next disabled"></span>
            </div>
        </main>
    </div>
</body>
</html>