<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Data Flow - BSP Architecture</title>
    <link rel="stylesheet" href="../css/style.css">
</head>
<body>
    <nav>
        <a href="../index.html" class="logo">BSP Docs</a>
        <ul>
            <li><a href="index.html" class="active">Architecture</a></li>
            <li><a href="../theory/index.html">Theory</a></li>
            <li><a href="../wiki/index.html">Wiki & Glossary</a></li>
            <li><a href="../specs/index.html">Specs</a></li>
            <li><a href="../training.html">Training</a></li>
            <li><a href="../eval.html">Evaluation</a></li>
        </ul>
    </nav>

    <div class="container">
        <aside class="sidebar">
            <h3>Architecture</h3>
            <ul>
                <li><a href="index.html">Overview</a></li>
                <li><a href="core-engine.html">Core Engine</a></li>
                <li><a href="data-flow.html" class="active">Data Flow</a></li>
                <li><a href="data-structures.html">Data Structures</a></li>
                <li><a href="server-sessions.html">Server & Sessions</a></li>
            </ul>
        </aside>

        <main class="content">
            <h1>Data Flow Pipeline</h1>
            <p>The transition from raw text to updated knowledge involves a 6-step pipeline. This pipeline executes for every user interaction, ensuring continuous learning.</p>

            <div class="diagram-container">
                <svg width="800" height="400" viewBox="0 0 800 400" xmlns="http://www.w3.org/2000/svg">
                    <!-- Nodes -->
                    <g transform="translate(50, 50)">
                        <rect width="100" height="60" rx="5" fill="#f1f5f9" stroke="#cbd5e1" stroke-width="2"/>
                        <text x="50" y="35" text-anchor="middle" font-weight="bold">Text Input</text>
                    </g>

                    <g transform="translate(200, 50)">
                        <rect width="120" height="60" rx="5" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                        <text x="60" y="35" text-anchor="middle" font-weight="bold">Tokenizer</text>
                    </g>

                    <g transform="translate(370, 50)">
                        <rect width="120" height="60" rx="5" fill="#dbeafe" stroke="#3b82f6" stroke-width="2"/>
                        <text x="60" y="35" text-anchor="middle" font-weight="bold">Bitset Encoder</text>
                    </g>

                    <g transform="translate(540, 50)">
                        <rect width="120" height="60" rx="5" fill="#dcfce7" stroke="#22c55e" stroke-width="2"/>
                        <text x="60" y="35" text-anchor="middle" font-weight="bold">Activator</text>
                    </g>

                    <g transform="translate(540, 200)">
                        <rect width="120" height="60" rx="5" fill="#fef9c3" stroke="#eab308" stroke-width="2"/>
                        <text x="60" y="35" text-anchor="middle" font-weight="bold">Surprise Calc</text>
                    </g>

                    <g transform="translate(370, 200)">
                        <rect width="120" height="60" rx="5" fill="#fee2e2" stroke="#ef4444" stroke-width="2"/>
                        <text x="60" y="35" text-anchor="middle" font-weight="bold">Learner</text>
                    </g>

                    <g transform="translate(200, 200)">
                        <rect width="120" height="60" rx="5" fill="#f3e8ff" stroke="#a855f7" stroke-width="2"/>
                        <text x="60" y="35" text-anchor="middle" font-weight="bold">Predictor</text>
                    </g>

                    <!-- Connections -->
                    <line x1="150" y1="80" x2="200" y2="80" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrow)"/>
                    <line x1="320" y1="80" x2="370" y2="80" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrow)"/>
                    <line x1="490" y1="80" x2="540" y2="80" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrow)"/>
                    <line x1="600" y1="110" x2="600" y2="200" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrow)"/>
                    <line x1="540" y1="230" x2="490" y2="230" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrow)"/>
                    <line x1="370" y1="230" x2="320" y2="230" stroke="#94a3b8" stroke-width="2" marker-end="url(#arrow)"/>
                    
                    <!-- Context Loop -->
                    <path d="M260 260 L260 300 L650 300 L650 110" fill="none" stroke="#a855f7" stroke-width="2" stroke-dasharray="5,5"/>
                    <text x="450" y="320" text-anchor="middle" fill="#a855f7" font-size="12">Next Step Context</text>

                    <defs>
                        <marker id="arrow" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
                            <path d="M0,0 L0,6 L9,3 z" fill="#94a3b8" />
                        </marker>
                    </defs>
                </svg>
            </div>

            <h2 id="step-1-tokenization">1. Tokenization & Hashing</h2>
            <p>The raw input string is split into words (tokens). Each token is hashed to a unique integer ID (0 to 1,000,000). We use n-grams (e.g., "artificial intelligence") to capture local context immediately.</p>

            <h2 id="step-2-encoding">2. Bitset Encoding</h2>
            <p>The list of IDs is converted into a <code>Bitset</code>. This single object represents the entire input state efficiently.</p>
            <pre><code>Input: "The cat sat"
IDs: [104, 552, 891]
Bitset: {104, 552, 891}</code></pre>

            <h2 id="step-3-activation">3. Activation</h2>
            <p>The system queries an <strong>inverted index</strong> to find groups that contain these features. It scores them based on overlap and selects the Top-K (e.g., 16) "Active Groups". These groups form the system's "Understanding" of the input.</p>

            <h2 id="step-4-surprise">4. Surprise Calculation</h2>
            <p>The system reconstructs the features from the Active Groups and compares them to the actual input.</p>
            <ul>
                <li><strong>Unexplained Bits:</strong> Features in Input but NOT in Active Groups.</li>
                <li><strong>Hallucinations:</strong> Features in Active Groups but NOT in Input.</li>
            </ul>

            <h2 id="step-5-learning">5. Learning</h2>
            <p>If Surprise is high, the <strong>Learner</strong> activates:</p>
            <ul>
                <li><strong>Update Memberships:</strong> Add unexplained bits to active groups.</li>
                <li><strong>Create Group:</strong> If no group fits well, create a new one from the unexplained bits.</li>
                <li><strong>Update Deductions:</strong> Link the <em>previous</em> active groups to the <em>current</em> ones.</li>
            </ul>

            <div class="pager">
                <a href="core-engine.html" class="pager-link prev">
                    <span class="label">Previous</span>
                    <span class="title">Core Engine</span>
                </a>
                <a href="data-structures.html" class="pager-link next">
                    <span class="label">Next</span>
                    <span class="title">Data Structures</span>
                </a>
            </div>
        </main>
    </div>
</body>
</html>
